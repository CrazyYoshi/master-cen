function DatetimeToJsDate(e){var t=e.split("-"),o=t[0],s=(Number(t[1])-1).toString(),r=t[2].split(" "),a=r[0],n=r[1].split(":"),i=n[0],l=n[1],p=n[2];return new Date(o,s,a,i,l,p)}function DateSQLToJsDate(e){var t=e.split("-"),o=t[0],s=(Number(t[1])-1).toString(),r=t[2];return new Date(o,s,r)}function wildSearch(e,t){return new RegExp("^"+t.split("*").join(".*")+"$").test(e)}var app=angular.module("metroSecours",["ui.router","ngAnimate","ngSanitize","ngTouch","mOsCtrl","ngCookies"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,o){t.otherwise("/"),o.html5Mode(!0),e.state("main",{controller:"MainCtrl",url:"/",templateUrl:"assets/partials/main.html"}).state("main.signup",{controller:"SignupCtrl",url:"signup",templateUrl:"assets/partials/form_connexion.html"}).state("main.signin",{controller:"SigninCtrl",url:"signin",templateUrl:"assets/partials/form_inscription.html"}).state("profile",{controller:"ProfileCtrl",templateUrl:"assets/partials/profile.html"}).state("profile.manage",{controller:"ProfileEditCtrl",url:"/profile",templateUrl:"assets/partials/profile.manage.html"}).state("profile.fidelity",{controller:"ChallengesCtrl",url:"/profile/challenges",templateUrl:"assets/partials/profile.challenges.html"}).state("contact",{controller:"ContactCtrl",url:"/contact",templateUrl:"assets/partials/contact.html"})}]),app.run(["$rootScope","$http","$state","$cookies",function(e,t,o,s){e.rootUrl="https://cen.metrosecours.amnesia.cafe",e.toCome=!0;var r=s.getObject("remember");void 0!==r?(r.isAuto=!0,t({method:"POST",url:e.rootUrl+"/php/connexion.php",data:$.param(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){t.data.success?(console.log("Auto connect réussie"),e.loggedUser=t.data.user,e.logged=!0):console.log("Auto connect echec")},function(e){console.log("Auto connect echec")})):e.logged=!1,e.logOut=function(){e.logged=!1,e.loggedUser=void 0,s.remove("remember"),console.log("Logged Out -> Redirect"),o.go("main")},e.$on("$stateChangeSuccess",function(t,s,r){e.modalActive="main.signin"!==o.current.name&&"main.signup"!==o.current.name,e.logged?"main.signup"!==s.name&&"main.signin"!==s.name||(console.log("Redirecting to main, because already logged"),o.go("main")):"main.signup"!==s.name&&"main"!==s.name&&"main.signin"!==s.name&&(console.log("Redirecting to main, because not logged"),o.go("main"))})}]);var ctrl=angular.module("mOsCtrl",[]),meLeisuresResize=function(){var e=$("#leisures-bg"),t=$("#leisures-text"),o=(parseInt(t.css("padding-bottom")),t.outerHeight(!0));e.height(o)},openCloseMenu=function(e){e=e||!1,console.log("Launched"),console.log(e);var t=$("#hamburger"),o=$("#unroll"),s=$("nav");$("#unroll a");t.hasClass("active")||o.hasClass("active")||e?(t.removeClass("active"),s.removeClass("active"),o.removeClass("active")):(t.addClass("active"),s.addClass("active"),o.addClass("active"))};$(function(){}),ctrl.controller("ChallengesCtrl",["$scope","$http","$rootScope","$sce",function(e,t,o,s){}]),ctrl.controller("ContactCtrl",["$scope","$http","$rootScope","$sce",function(e,t,o,s){o.footer="Une animation viendra dynamiser le tout !",e.reset={name:"",email:"",subject:"",mail:""},e.send=function(){t({method:"POST",url:o.rootUrl+"/php/sendMail.php",data:$.param(e.maildata),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){var o=t.data;o.success?(e.maildata=angular.copy(e.reset),e.response=o.success):e.response=o.error},function(t){e.response="Soucis technique, le mail est même pas arrivé jusqu'au serveur, la loose"})}}]),ctrl.controller("MainCtrl",["$scope","$state","$http","$rootScope","$filter",function(e,t,o,s,r){e.lines=[],e.stations=[],e.problems=[],e.pbType=[],e.form={},e.form.msg="",e.p={type:"",line:"",station:""},e.submitProblem=function(){var t=e.p,r=new Date;r=r.getUTCFullYear()+"-"+("00"+(r.getUTCMonth()+1)).slice(-2)+"-"+("00"+r.getUTCDate()).slice(-2)+" "+("00"+r.getUTCHours()).slice(-2)+":"+("00"+r.getUTCMinutes()).slice(-2)+":"+("00"+r.getUTCSeconds()).slice(-2);var a={date:r,problem_type_id:t.type,station_id:t.station,line_id:t.line,utilisateur_id:s.loggedUser.id};o({method:"POST",url:s.rootUrl+"/php/addProblem.php",data:$.param(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){e.form.msg=t.data.msg,t.data.success&&e.getDatas()},function(){e.response="Soucis technique"}),e.getDatas()},e.problemFormCheck=function(){var t=e.p;e.p.disabled=!(""!==t.line&&""!==t.station&&""!==t.type)},e.stationSelect=function(){e.selectedLine=r("filter")(e.lines,{id:e.p.line})[0],e.problemFormCheck()},e.getDatas=function(){o.get(s.rootUrl+"/php/getLine.php").then(function(t){e.lines=t.data},function(e){}),o.get(s.rootUrl+"/php/getProblemsType.php").then(function(t){e.pbType=t.data},function(e){}),o.get(s.rootUrl+"/php/getProblems.php").then(function(t){angular.forEach(t.data,function(e){e.line="Ligne "+e.line,e.date=DatetimeToJsDate(e.date)}),e.problems=t.data},function(e){}),o.get(s.rootUrl+"/php/getStations.php").then(function(t){e.stations=t.data},function(e){})},e.getDatas(),e.problemFormCheck()}]),ctrl.controller("ProfileCtrl",["$scope","$state","$http","$rootScope",function(e,t,o,s){"profile"===t.current.name&&t.go("profile.manage")}]),ctrl.controller("ProfileEditCtrl",["$scope","$state","$http","$rootScope",function(e,t,o,s){var r=s.loggedUser;e.user={pseudo:r.pseudo,email:r.email,tel:r.tel,passwd:"",verifpasswd:""},e.form={pseudo:"",email:"",tel:"",passwd:"",verifpasswd:"",disabled:!0,msg:"",pA:!1,eA:!1};var a=function(t,r){var a={email:t?void 0:r,pseudo:t?r:void 0};o({method:"POST",url:s.rootUrl+"/php/checkif.php",data:$.param(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(o){t?e.form.pA=o.data.pseudoAvailable:e.form.eA=o.data.mailAvailable},function(){e.response="Soucis technique"})};e.checkForm=function(){var t=e.user,o=e.form,s=void 0!==t.passwd&&""!==t.passwd,n=!1;void 0!==t.pseudo&&t.pseudo.length>=3?(o.pseudo="",t.pseudo!==r.pseudo?(a(!0,t.pseudo),o.pA?o.pseudo="Le pseudo est disponible":(n=!0,o.pseudo="Le pseudo est déjà pris.")):o.pseudo=""):(n=!0,o.pseudo="Le pseudo est trop court"),void 0!==t.pseudo&&t.email.length>=6?(o.email="",t.email!==r.email?(a(!1,t.email),o.pA?o.pseudo="L'adresse mail est disponible":(n=!0,o.pseudo="L'adresse mail est déjà prise.")):o.email=""):(n=!0,o.email="L'adresse est trop courte pour être correcte."),s?t.passwd.length>=6?(o.passwd="",t.passwd===t.verifpasswd?(o.passwd="",o.verifpasswd=""):(n=!0,o.verifpasswd=o.passwd="Les mots de passe ne correspondent pas")):(n=!0,o.passwd="Le mot de passe est trop court."):o.passwd="",o.disabled=n,e.form=o},e.updateProfile=function(){var t=e.user,r={id:s.loggedUser.id,pseudo:t.pseudo,email:t.email,tel:t.tel,passwd:void 0!==t.passwd&&""!==t.passwd?t.passwd:null};o({method:"POST",url:s.rootUrl+"/php/updateProfile.php",data:$.param(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){e.form.msg=t.data.msg,t.data.success&&(s.loggedUser.pseudo=t.data.user.p,s.loggedUser.email=t.data.user.e,s.loggedUser.tel=t.data.user.t,null!==r.passwd&&(s.loggedUser.password=t.data.user.password))},function(){e.response="Soucis technique"})},e.checkForm()}]),ctrl.controller("SigninCtrl",["$scope","$http","$rootScope","$state","$cookies",function(e,t,o,s,r){e.user={pseudo:"",email:"",tel:"",passwd:"",verifpasswd:""},e.form={pseudo:"",email:"",tel:"",passwd:"",passverif:"",disabled:!0,msg:""},e.signin=function(){t({method:"POST",url:o.rootUrl+"/php/inscription.php",data:$.param(e.user),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){e.form=t.data,t.data.success&&(r.put("newuser",e.user.pseudo),s.go("main.signup"))},function(){e.response="Soucis technique"})},e.checkForm=function(){e.form.passverif=e.user.passwd==e.user.verifpasswd?"":"Les mots de passe ne correspondent pas",e.form.passwd=void 0!=e.user.passwd&&e.user.passwd.length>=6?"":"Mot de passe trop court",e.form.pseudo=void 0!=e.user.pseudo&&e.user.pseudo.length>3?"":"Votre pseudo est trop court.",e.form.email=void 0!=e.user.email&&e.user.email.length>3?"":"Veuillez renseigner une adresse mail conforme.",e.form.disabled=e.form.passverif.length>0&&e.form.passwd.length>0&&e.form.pseudo.length>0&&e.form.email.length>0}}]),ctrl.controller("SignupCtrl",["$scope","$http","$rootScope","$cookies","$state",function(e,t,o,s,r){e.user={pseudo:"",passwd:"",rememberme:!1},e.form={pseudo:"",passwd:""};var a=s.get("newuser");e.user.pseudo=void 0!==a?a:"",e.signup=function(){t({method:"POST",url:o.rootUrl+"/php/connexion.php",data:$.param(e.user),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){if(e.form=t.data.form,t.data.success){if(e.user.rememberme){var a={i:t.data.user.id,h:t.data.user.password};s.putObject("remember",a)}o.loggedUser=t.data.user,o.logged=!0,r.go("main")}},function(){e.response="Soucis technique"})},e.checkform=function(){e.form.pseudo=void 0!==e.user.pseudo&&e.user.pseudo.length<3?"Le pseudo est trop court pour être correct":"",e.form.passwd=void 0!==e.user.passwd&&e.user.passwd.length<6?"Le mot de passe est trop court pour être correct":"",e.form.disabled=e.form.pseudo>0&&e.form.passwd>0}}]);